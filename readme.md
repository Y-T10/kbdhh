# KBDHH
英字配列キーボード向け日本語レイアウトDLL．

## 概要
KBDHHは、WindowsにてUS配列のキーボードによる日本語入力を実現するレイアウトDLLで、英字配列に下記のキーが追加されたレイアウトを表す．
これより変換/無変換キーを用いてIMEのオン/オフを切り替え、英字キーボードでも日本語入力を可能にする．

- [x] 変換
- [x] 無変換

## DLLのビルド
### 構成マネージャ
実行環境に合わせて構成、プラットフォームを決定する．
多くの場合では構成環境を`Release`、プラットフォームを実行環境のアーキテクチャに設定すればよい．

### オプション
コンパイル、ビルドのオプションを下記のとおりに設定する．

- 全般
	* 構成の種類: ダイナミックライブラリ
	* プラットフォームツールセット: `WindowsApplicationForDrivers10.0`
- リンカ
    * 入力
        + すべての既定のライブラリの無視: はい（`/NODEFAULTLIB`）
        + モジュール定義ファイル: `path/to/file.def`
    * 詳細設定
        + エントリポイントなし: はい（`/NOENTRY`）
    * すべてのオプション
        + その他のオプション: `-merge:.edata=.data -merge:.rdata=.data -merge:.bss=.data -section:.data,r /ignore:4254`

上記の設定に加え、プログラムの実装ミスをコンパイル時に検知するために下記の設定を追加してもよい．

- C/C++
    * 全般
        + 警告レベル: レベル4

### モジュール定義ファイル
キーボードレイアウトDLLの実装を記述しただけではC関数`KbdLayerDescriptor`、`KbdNlsLayerDescriptor`をエクスポートできない．
これらの関数を外部に公開するにはモジュール定義ファイルが必要になる．
このファイルの記述は下図のとおりで、リンカにDLLの生成を指示する．
1行目の`LIBRARY`節は名前`KBDHH`を持つDLLの生成をリンカーに指示する．
この節はファイルの先頭に置かれる必要がある．
3-5行目の`EXPORTS`節はエクスポート対象の関数名とその序数を定義する．
各関数に割り当てられる序数は決められている．

```
LIBRARY KBDHH

EXPORTS
    KbdLayerDescriptor    @1
    KbdNlsLayerDescriptor @2
```

## 実装時に気負付けるべき点
### 最低限の実装
実装では、スキャンコードから仮想キーコードへの変換表が必要になる．

